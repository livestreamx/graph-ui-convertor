{% macro render_group(group, query) %}
  <section class="group">
    <div class="group-header">
      <div>
        <div class="group-title">{{ group.field }}: {{ group.value }}</div>
        <div class="group-count">{{ group.count }} scenes</div>
      </div>
      <a
        class="group-filter"
        href="/catalog{% if query %}?q={{ query|urlencode }}&group={{ group.field }}:{{ group.value }}{% else %}?group={{ group.field }}:{{ group.value }}{% endif %}"
      >
        Filter
      </a>
    </div>
    {% if group.children %}
      <div class="group-children">
        {% for child in group.children %}
          {{ render_group(child, query) }}
        {% endfor %}
      </div>
    {% else %}
      <div class="card-grid">
        {% for item in group.items %}
          <article class="card">
            <div class="card-body">
              <div class="card-title">{{ item.title }}</div>
              <div class="card-meta">
                <span>{{ item.markup_type }}</span>
                <span>{{ item.updated_at }}</span>
              </div>
              {% if item.tags %}
                <div class="tag-row">
                  {% for tag in item.tags %}
                    <span class="tag">{{ tag }}</span>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
            <div class="card-actions">
              <a class="primary-button" href="/catalog/{{ item.scene_id }}">View</a>
              <a class="ghost-button" href="/api/scenes/{{ item.scene_id }}?download=true">Download</a>
            </div>
          </article>
        {% endfor %}
      </div>
    {% endif %}
  </section>
{% endmacro %}
