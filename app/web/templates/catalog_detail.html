{% extends "base.html" %}

{% block content %}
  <section class="detail-header">
    <a class="ghost-button" href="/catalog">Back to catalog</a>
    <div class="detail-title">{{ item.title }}</div>
    <div class="detail-meta">
      <span>{{ item.markup_type }}</span>
      <span>Updated {{ item.updated_at }}</span>
      <span>Scene ID {{ item.scene_id }}</span>
    </div>
    {% if item.tags %}
      <div class="tag-row">
        {% for tag in item.tags %}
          <span class="tag">{{ tag }}</span>
        {% endfor %}
      </div>
    {% endif %}
  </section>

  <section class="detail-grid">
    <div class="detail-card">
      <h3>Open & edit</h3>
      <p>
        1. Download the .excalidraw file.<br />
        2. Import into Excalidraw, edit, export as .excalidraw.<br />
        3. Upload the edited file and convert back to markup.
      </p>
      <div class="button-row">
        <a class="primary-button" target="_blank" href="{{ excalidraw_open_url }}">Open Excalidraw</a>
        <a class="ghost-button" href="/api/scenes/{{ item.scene_id }}?download=true">Download .excalidraw</a>
      </div>
      <p class="note">If the scene does not load, import the downloaded file manually.</p>
    </div>

    <div class="detail-card">
      <h3>Upload edited file</h3>
      <form
        class="upload-form"
        hx-post="/api/scenes/{{ item.scene_id }}/upload"
        hx-target="#action-result"
        hx-encoding="multipart/form-data"
      >
        <input type="file" name="file" accept=".json,.excalidraw" required />
        <button class="primary-button" type="submit">Upload</button>
      </form>
    </div>

    <div class="detail-card">
      <h3>Convert back to markup</h3>
      <form
        hx-post="/api/scenes/{{ item.scene_id }}/convert-back"
        hx-target="#action-result"
      >
        <button class="ghost-button" type="submit">Run conversion</button>
      </form>
      <p class="note">Output is stored in the roundtrip directory on shared storage.</p>
    </div>
  </section>

  <section class="detail-card">
    <h3>Metadata snapshot</h3>
    <div class="meta-grid">
      <div>
        <div class="meta-label">Markup file</div>
        <div class="meta-value">{{ item.markup_rel_path }}</div>
      </div>
      <div>
        <div class="meta-label">Excalidraw file</div>
        <div class="meta-value">{{ item.excalidraw_rel_path }}</div>
      </div>
      <div>
        <div class="meta-label">FineDog unit</div>
        <div class="meta-value">{{ item.finedog_unit_id }}</div>
      </div>
    </div>
  </section>

  <div id="action-result" class="action-result"></div>
{% endblock %}
