{% extends "base.html" %}

{% block content %}
  <section class="detail-header">
    <a class="ghost-button" href="/catalog">Back to catalog</a>
    <div class="detail-title">{{ item.title }}</div>
    <div class="detail-meta">
      <span>{{ "markup_type" | humanize_text }}: {{ item.markup_type | humanize_text }}</span>
      <span>Updated {{ item.updated_at | msk_datetime }}</span>
      <span>Scene ID {{ item.scene_id }}</span>
    </div>
    {% if item.tags %}
      <div class="tag-row">
        {% for tag in item.tags %}
          <span class="tag">{{ tag }}</span>
        {% endfor %}
      </div>
    {% endif %}
  </section>

  <section class="detail-grid">
    <div class="detail-card">
      <h3>Open the diagram</h3>
      <p>
        Open the scene in {{ diagram_label }} or download the file for manual import and editing.
      </p>
      <div class="button-row">
        <a class="primary-button" target="_blank" href="{{ diagram_open_url }}">Open {{ diagram_label }}</a>
        <a class="ghost-button" href="/api/scenes/{{ item.scene_id }}?download=true">Download {{ diagram_ext }}</a>
        <a class="ghost-button" href="/api/markup/{{ item.scene_id }}?download=true">Download markup.json</a>
      </div>
      {% if not scene_available %}
        {% if on_demand_enabled %}
          <p class="note">Scene will be generated on demand from markup.</p>
        {% else %}
          <p class="note">Scene file not found in {{ diagram_dir_label }}. Run build-all before opening.</p>
        {% endif %}
      {% elif open_mode == "manual" %}
        <p class="note">Scene is too large for URL sharing. Use Download + Import.</p>
      {% elif open_mode == "local_storage" %}
        <p class="note">Scene is injected via local storage for same-origin {{ diagram_label }}.</p>
      {% else %}
        <p class="note">If the scene does not load, import the downloaded file manually.</p>
      {% endif %}
    </div>
  </section>

  <section class="detail-card">
    <h3>Metadata snapshot</h3>
    <div class="meta-grid">
      <div>
        <div class="meta-label">Markup file</div>
        <div class="meta-value">{{ item.markup_rel_path }}</div>
      </div>
      <div>
        <div class="meta-label">{{ diagram_label }} file</div>
        <div class="meta-value">{{ diagram_rel_path }}</div>
      </div>
      <div>
        <div class="meta-label">FineDog unit</div>
        <div class="meta-value">{{ item.finedog_unit_id }}</div>
      </div>
      <div>
        <div class="meta-label">{{ "criticality_level" | humanize_text }}</div>
        <div class="meta-value">{{ item.criticality_level | humanize_text }}</div>
      </div>
      <div>
        <div class="meta-label">{{ "team_id" | humanize_text }}</div>
        <div class="meta-value">{{ item.team_name }}</div>
      </div>
    </div>
    {% if item.markup_meta %}
      <div class="meta-grid meta-extra">
        {% for key, value in item.markup_meta.items() %}
          <div>
            <div class="meta-label">{{ key | humanize_text }}</div>
            <div class="meta-value">{{ value }}</div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </section>
{% endblock %}
