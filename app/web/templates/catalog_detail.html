{% extends "base.html" %}

{% block content %}
  <section class="detail-header">
    <a class="ghost-button" href="/catalog?lang={{ lang }}">{{ t("Back to catalog") }}</a>
    <div class="detail-title">{{ item.title }}</div>
    <div class="detail-markup-type">
      <span class="detail-markup-type-label">{{ "markup_type" | humanize_text }}</span>
      <span class="detail-markup-type-value">{{ item.markup_type | humanize_text }}</span>
    </div>
    <div class="detail-meta">
      <span>{{ t("Updated") }} {{ item.updated_at | msk_datetime }}</span>
      <span>{{ t("Scene ID") }} {{ item.scene_id }}</span>
    </div>
    {% if item.tags %}
      <div class="tag-row">
        {% for tag in item.tags %}
          <span class="tag">{{ tag }}</span>
        {% endfor %}
      </div>
    {% endif %}
  </section>

  <section class="detail-grid">
    <div class="detail-card">
      <h3>{{ t("Get the diagram") }}</h3>
      <div class="button-row">
        {% if diagram_excalidraw_enabled %}
          <a class="primary-button" target="_blank" href="{{ excalidraw_open_url }}">{{ t("Open Excalidraw") }}</a>
        {% endif %}
        <a class="ghost-button" href="/api/scenes/{{ item.scene_id }}?format=excalidraw&download=true">
          {{ t("Download .excalidraw") }}
        </a>
        <a
          class="{% if diagram_excalidraw_enabled %}ghost-button unidraw-button{% else %}primary-button{% endif %}"
          href="/api/scenes/{{ item.scene_id }}?format=unidraw&download=true"
        >
          {{ t("Download .unidraw") }}
        </a>
      </div>
      {% if not excalidraw_scene_available %}
        {% if on_demand_enabled %}
          <p class="note">{{ t("Scene will be generated on demand from markup.") }}</p>
        {% else %}
          <p class="note">
            {{ t("Scene file not found in {dir_name}. Run build-all before opening.", dir_name=excalidraw_dir_label) }}
          </p>
        {% endif %}
      {% elif open_mode == "manual" %}
        <p class="note">{{ t("Scene is too large for URL sharing. Use Download + Import.") }}</p>
      {% else %}
        <p class="note">{{ t("If the scene does not load, import the downloaded file manually.") }}</p>
      {% endif %}
    </div>
  </section>

  <section class="detail-card markup-info-card">
    <h3>{{ t("Markup information") }}</h3>
    <div class="meta-grid">
      <div class="meta-item">
        <div class="meta-label">{{ t("Markup file") }}</div>
        <div class="meta-value meta-mono">{{ item.markup_rel_path }}</div>
      </div>
      <div class="meta-item">
        <div class="meta-label">{{ "criticality_level" | humanize_text }}</div>
        <div class="meta-value">
          <span class="meta-pill">{{ item.criticality_level | humanize_text }}</span>
        </div>
      </div>
      <div class="meta-item">
        <div class="meta-label">{{ t("Service ID") }}</div>
        <div class="meta-value">
          {% if service_external_url %}
            <a class="meta-link" target="_blank" href="{{ service_external_url }}">
              <span class="meta-link-text">{{ item.finedog_unit_id }}</span>
              <span class="meta-link-icon" aria-hidden="true">↗</span>
            </a>
          {% else %}
            <span class="meta-pill">{{ item.finedog_unit_id }}</span>
          {% endif %}
        </div>
      </div>
      <div class="meta-item">
        <div class="meta-label">{{ t("Team") }}</div>
        <div class="meta-value">
          {% if team_external_url %}
            <a class="meta-link" target="_blank" href="{{ team_external_url }}">
              <span class="meta-link-text">{{ item.team_name }}</span>
              <span class="meta-link-icon" aria-hidden="true">↗</span>
            </a>
          {% else %}
            <span class="meta-pill">{{ item.team_name }}</span>
          {% endif %}
        </div>
      </div>
    </div>
    {% if item.markup_meta %}
      <div class="meta-grid meta-extra">
        {% for key, value in item.markup_meta.items() %}
          <div>
            <div class="meta-label">{{ key | humanize_text }}</div>
            <div class="meta-value">{{ value }}</div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </section>
{% endblock %}
